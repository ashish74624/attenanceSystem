(()=>{var e={73:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});const a=require("axios");var o=n.n(a),s=n(689),r=n.n(s);const l=function(e){const[t,n]=(0,s.useState)(!1),[a,l]=(0,s.useState)(""),[c,i]=(0,s.useState)(),[d,u]=(0,s.useState)("");return r().createElement("div",{className:"card"},r().createElement("div",{className:"our-card-top"},t&&r().createElement("div",{className:"our-custom-input"},r().createElement("div",{className:"our-custom-input-interior"},r().createElement("input",{onChange:e=>i(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),r().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`Picture of ${e.name}`,style:{width:"100%",height:"180px",objectFit:"cover",objectPosition:"top"}})),r().createElement("div",{className:"card-body"},!t&&r().createElement(r().Fragment,null,r().createElement("h4",null,e.name),r().createElement("p",{className:"text-muted small"},e.course),!e.readOnly&&r().createElement(r().Fragment,null,r().createElement("button",{onClick:()=>{n(!0),l(e.name),u(e.course),i("")},className:"btn btn-sm btn-primary"},"Edit")," ",r().createElement("button",{onClick:async()=>{o().delete(`/student/${e.id}`),e.setStudents((t=>t.filter((t=>t._id!=e.id))))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&r().createElement("form",{onSubmit:async function(t){t.preventDefault(),n(!1),e.setStudents((t=>t.map((function(t){return t._id==e.id?{...t,name:a,course:d}:t}))));const s=new FormData;c&&s.append("photo",c),s.append("_id",e.id),s.append("name",a),s.append("course",d);const r=await o().post("/update-student",s,{headers:{"Content-Type":"multipart/form-data"}});r.data&&e.setStudents((t=>t.map((function(t){return t._id==e.id?{...t,photo:r.data}:t}))))}},r().createElement("div",{className:"mb-1"},r().createElement("input",{autoFocus:!0,onChange:e=>l(e.target.value),type:"text",className:"form-control form-control-sm",value:a})),r().createElement("div",{className:"mb-2"},r().createElement("input",{onChange:e=>u(e.target.value),type:"text",className:"form-control form-control-sm",value:d})),r().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",r().createElement("button",{onClick:()=>n(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const{MongoClient:e,ObjectId:t}=n(13),a=n(860),o=n(738)(),s=n(109),r=n(470),l=n(441);let c;const i=n(17),d=n(689),u=n(684),m=n(73).Z;r.ensureDirSync(i.join("../frontend/public","uploaded-photos"));const p=a();function b(e,t,n){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.course&&(e.body.course=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:s(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),course:s(e.body.course.trim(),{allowedTags:[],allowedAttributes:{}})},n()}p.set("view engine","ejs"),p.set("views","../frontend/views"),p.use(a.static("../frontend/public")),p.use(a.json()),p.use(a.urlencoded({extended:!1})),p.get("/",((e,t)=>{t.render("index")})),p.get("/studentdatabase",(async(e,t)=>{const n=await c.collection("students").find().toArray(),a=u.renderToString(d.createElement("div",null,d.createElement("nav",null,d.createElement("a",{href:"/",className:"logo"},"Student Attendance Management System"),d.createElement("ul",null,d.createElement("li",null,d.createElement("a",{href:"/home"},"Home")),d.createElement("li",null,d.createElement("a",{href:"/studentdatabase"},"Student Database")),d.createElement("li",null,d.createElement("a",{href:"/"},"Take Attendance")),d.createElement("li",null,d.createElement("a",{href:"/about"},"README")))),d.createElement("div",{className:"container"},d.createElement("h2",null,"Student Database"),d.createElement("br",null),!n.length&&d.createElement("p",null,"There are no students yet, the admin needs to add a few."),d.createElement("div",{className:"student-grid mb-3"},n.map((e=>d.createElement(m,{key:e._id,name:e.name,course:e.course,photo:e.photo,id:e._id,readOnly:!0})))),d.createElement("p",null,d.createElement("a",{href:"/admin"},"Login / manage the student listings.")))));t.render("studentdatabase",{generatedHTML:a})})),p.get("/about",((e,t)=>{t.render("about")})),p.get("/home",((e,t)=>{t.render("home")})),p.use((function(e,t,n){t.set("WWW-Authenticate","Basic realm='Our MERN App'"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?n():(console.log(e.headers.authorization),t.status(401).send("Try again"))})),p.get("/admin",((e,t)=>{t.render("admin")})),p.get("/api/students",(async(e,t)=>{const n=await c.collection("students").find().toArray();t.json(n)})),p.get("/api/getStudentByName/:studentName",(async(e,t)=>{const n=decodeURIComponent(e.params.studentName),a=await c.collection("students").findOne({name:n});t.json(a)})),p.post("/create-student",o.single("photo"),b,(async(e,n)=>{if(e.file){const t=`${Date.now()}.jpg`;await l(e.file.buffer).jpeg({quality:80}).toFile(i.join("../frontend/public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const a=await c.collection("students").insertOne(e.cleanData),o=await c.collection("students").findOne({_id:new t(a.insertedId)});n.send(o)})),p.delete("/student/:id",(async(e,n)=>{"string"!=typeof e.params.id&&(e.params.id="");const a=await c.collection("students").findOne({_id:new t(e.params.id)});a.photo&&r.remove(i.join("../frontend/public","uploaded-photos",a.photo)),c.collection("students").deleteOne({_id:new t(e.params.id)}),n.send("Good job")})),p.post("/update-student",o.single("photo"),b,(async(e,n)=>{if(e.file){const a=`${Date.now()}.jpg`;await l(e.file.buffer).jpeg({quality:80}).toFile(i.join("../frontend/public","uploaded-photos",a)),e.cleanData.photo=a;const o=await c.collection("students").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData});o.value.photo&&r.remove(i.join("../frontend/public","uploaded-photos",o.value.photo)),n.send(a)}else c.collection("students").findOneAndUpdate({_id:new t(e.body._id)},{$set:e.cleanData}),n.send(!1)})),async function(){const t=new e("mongodb+srv://jolynn:b1U3%40cr0wnn@sams-students.zk4e44c.mongodb.net/SAMS-students?authSource=admin");await t.connect(),c=t.db(),p.listen(3e3)}()})()})();